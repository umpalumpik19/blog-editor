(()=>{"use strict";function e(e){const t=e=>{if(!e)return!1;const t=window.getComputedStyle(e),n=["auto","scroll"].includes(t.overflowX),s=["auto","scroll"].includes(t.overflowX),{offsetHeight:i,scrollHeight:o,offsetWidth:r,scrollWidth:d}=e;return d>r&&n||o>i&&s};e.addEventListener("wheel",(n=>{const{deltaX:s,deltaY:i,target:o}=n,r=(n=>{let s=n;for(;!t(s)&&(s=s.parentElement,s!==e&&s!==document.documentElement););return s})(o);let d;var l;d=Math.abs(s)>Math.abs(i)?"horizontal":Math.abs(s)<Math.abs(i)?"vertical":"both",(["vertical","both"].includes(d)&&((l=r)&&0===l.scrollTop&&i<0||(e=>e&&Math.ceil(e.scrollTop+e.clientHeight)>=e.scrollHeight)(r)&&i>0)||["horizontal","both"].includes(d)&&((e=>e&&0===e.scrollLeft)(r)&&s<0||(e=>e&&Math.ceil(e.scrollLeft+e.clientWidth)>=e.scrollWidth)(r)&&s>0))&&n.preventDefault()}),{passive:!1})}class t{constructor(e,n){if(!(e instanceof HTMLSelectElement))throw new TypeError("select must be a HTMLSelectElement");n="[object Object]"===Object.prototype.toString.call(n)?n:{},this.config={theme:["light","dark"].includes(n.theme)?n.theme:"light",height:n.height&&!isNaN(n.height)?n.height:40,imageSize:t.getImageSize(n.imageSize),columnsCount:n.columnsCount&&!isNaN(n.columnsCount)?n.columnsCount:2,insertSVG:!!n.insertSVG},this.id=t.getId(),this.select=e,this.disabled=this.select.disabled,this.options=this.getOptions(),this.isDropdownOpened=!1,this.handleContainerClick=this.handleContainerClick.bind(this),this.handleSelectChange=this.handleSelectChange.bind(this),this.handleOptionMouseenter=this.handleOptionMouseenter.bind(this),this.handleOptionMouseleave=this.handleOptionMouseleave.bind(this),this.handleOptionClick=this.handleOptionClick.bind(this),this.handleDocClick=this.handleDocClick.bind(this),this.handleDocKeyDown=this.handleDocKeyDown.bind(this),this.updateDropdownOverflow=this.updateDropdownOverflow.bind(this),this.init()}init(){const{theme:e,height:t,imageSize:n,columnsCount:s}=this.config,i=document.createElement("button");i.classList.add("tprev"),i.setAttribute("type","button"),i.setAttribute("role","combobox"),i.setAttribute("aria-expanded","false"),i.setAttribute("aria-controls",this.id),i.setAttribute("aria-owns",this.id),"dark"===e&&i.classList.add("tprev_dark"),i.style.height=`${t}px`,this.disabled&&i.classList.add("tprev_disabled"),this.select.after(i),i.append(this.select),this.select.style.display="none";const o=document.createElement("div");o.classList.add("tprev__selected-option");const r=this.options.find((e=>e.selected));r&&(o.innerHTML=r.label),i.append(o);const d=document.createElement("div");d.classList.add("tprev-dropdown","tprev-dropdown_hidden"),"dark"===e&&d.classList.add("tprev-dropdown_dark"),d.id=this.id;const l=document.createElement("div");l.classList.add("tprev-dropdown__inner"),l.setAttribute("role","listbox"),l.style.gridTemplateColumns=`repeat(${s}, ${n[0]}px)`,this.createOptionsElements(),l.append(...this.options.map((e=>e.element))),d.append(l);const a=document.createElement("div");a.classList.add("tprev__noaction"),this.container=i,this.selectedOption=o,this.dropdown=d,this.dropdownInner=l,this.noaction=a,this.setHandlers()}getOptions(){return Array.from(this.select.options).map((e=>({value:e.value,img:e.getAttribute("data-img")||"",darkImg:e.getAttribute("data-img-dark")||"",label:e.textContent.replace(/\n/g,"").trim(),disabled:e.disabled,selected:e.selected})))}createOptionsElements(){const{theme:e,imageSize:t,insertSVG:n}=this.config;this.options.forEach((s=>{const i=document.createElement("button");i.type="button",i.classList.add("tprev-dropdown__option"),s.selected&&(i.classList.add("tprev-dropdown__option_selected"),i.ariaSelected=!0),s.disabled&&(i.classList.add("tprev-dropdown__option_disabled"),i.disabled=!0);const o=document.createElement("div");if(o.classList.add("tprev-dropdown__option-image"),o.style.width=`${t[0]}px`,o.style.height=`${t[1]}px`,s.imageElement=o,i.append(o),s.img){const t="dark"===e&&s.darkImg?s.darkImg:s.img,i=t.endsWith(".svg");s.imgURL=t,s.isSVG=i,i&&n||(o.style.backgroundImage=`url('${t}')`)}const r=document.createElement("div");r.classList.add("tprev-dropdown__option-label"),r.innerHTML=s.label,r.style.maxWidth=`${t[0]}px`,i.append(r),s.element=i}))}setHandlers(){this.container.addEventListener("click",this.handleContainerClick),this.select.addEventListener("change",this.handleSelectChange),this.setOptionsHandlers()}setOptionsHandlers(){this.options.forEach((e=>{const{element:t}=e;t.addEventListener("click",this.handleOptionClick),e.disabled||(t.addEventListener("mouseenter",this.handleOptionMouseenter),t.addEventListener("mouseleave",this.handleOptionMouseleave))}))}update(){this.isDropdownOpened&&this.closeDropdown(),this.removeOptionsHandlers(),this.options.forEach((e=>{let{element:t}=e;return t.remove()})),this.options=this.getOptions(),this.createOptionsElements(),this.setOptionsHandlers(),this.dropdownInner.append(...this.options.map((e=>e.element))),this.selectedOption.innerHTML="";const e=this.options.find((e=>e.selected));e&&(this.selectedOption.innerHTML=e.label)}destroy(){this.closeDropdown(),this.container.removeEventListener("click",this.handleContainerClick),this.select.removeEventListener("change",this.handleSelectChange),this.removeOptionsHandlers(),this.container.before(this.select),this.container.remove()}removeOptionsHandlers(){this.options.forEach((e=>{let{element:t}=e;t.removeEventListener("click",this.handleOptionClick),t.removeEventListener("mouseenter",this.handleOptionMouseenter),t.removeEventListener("mouseleave",this.handleOptionMouseleave)}))}handleContainerClick(){this.isDropdownOpened?this.closeDropdown():this.openDropdown()}openDropdown(){if(this.disabled||this.isDropdownOpened||!this.options.length)return;document.addEventListener("click",this.handleDocClick),document.addEventListener("keydown",this.handleDocKeyDown,{capture:!0,passive:!1}),this.dropdownInner.addEventListener("scroll",this.updateDropdownOverflow);const{top:t,right:n}=this.container.getBoundingClientRect(),s=n+10,i=t-10;this.dropdown.style.setProperty("--pos-x",`${s}px`),this.dropdown.style.setProperty("--pos-y",`${i}px`),document.body.append(this.dropdown),document.body.append(this.noaction),this.isDropdownOpened=!0,this.container.setAttribute("aria-expanded","true"),this.container.classList.add("tprev_active");const o=this.options.find((e=>e.selected));o&&o.element.scrollIntoView({behavior:"smooth",inline:"start",block:"center"}),this.updateDropdownOverflow(),this.dropdown.classList.remove("tprev-dropdown_hidden"),e(this.dropdown),this.config.insertSVG&&this.options.forEach((e=>{const{imgURL:t,isSVG:n}=e;t&&n&&this.loadSVG(t,e)}))}closeDropdown(){this.dropdown.classList.add("tprev-dropdown_hidden"),this.dropdown.addEventListener("transitionend",(()=>{document.removeEventListener("click",this.handleDocClick),document.removeEventListener("keydown",this.handleDocKeyDown,{capture:!0,passive:!1}),this.dropdownInner.removeEventListener("scroll",this.updateDropdownOverflow),this.dropdown.remove(),this.noaction.remove(),this.isDropdownOpened=!1,this.container.focus(),this.container.setAttribute("aria-expanded","false"),this.container.classList.remove("tprev_active")}),{once:!0})}updateDropdownOverflow(){if(!this.isDropdownOpened)return;this.dropdown.classList.remove("tprev-dropdown_scroll-start","tprev-dropdown_scroll-end");const{scrollTop:e,scrollLeft:t,offsetHeight:n,offsetWidth:s,scrollHeight:i,scrollWidth:o}=this.dropdownInner,r=Math.abs(e-(i-n))<1||i===n,d=Math.abs(t-(o-s))<1||o===s;(o>s||i>s)&&(this.dropdown.classList.toggle("tprev-dropdown_scroll-start",t||e),this.dropdown.classList.toggle("tprev-dropdown_scroll-end",!d||!r))}handleSelectChange(){const e=this.select.value,t=this.options.find((t=>t.value===e));if(!t)return;const n=this.options.find((e=>e.selected));n&&(n.selected=!1,n.element.classList.remove("tprev-dropdown__option_selected"),n.element.ariaSelected=!1),t.selected=!0,t.element.classList.add("tprev-dropdown__option_selected"),t.element.ariaSelected=!0,this.selectedOption.innerHTML=t.label}handleOptionClick(e){const t=e.currentTarget,n=this.options.find((e=>e.element===t));n.disabled||(this.select.value=n.value,window.setTimeout((()=>{this.select.dispatchEvent(new CustomEvent("interaction")),n.selected||this.select.dispatchEvent(new Event("change"))}),100),this.closeDropdown())}handleOptionMouseenter(e){const t=e.currentTarget,n=this.options.find((e=>e.element===t));n&&!n.disabled&&t.focus()}handleOptionMouseleave(e){const t=e.currentTarget,n=this.options.find((e=>e.element===t));n&&!n.disabled&&t.blur()}handleDocClick(e){this.container.contains(e.target)||this.dropdown.contains(e.target)||this.closeDropdown()}handleDocKeyDown(e){if("Escape"===e.key&&(e.preventDefault(),e.stopPropagation(),this.closeDropdown()),["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","PageUp","PageDown","Tab"].includes(e.key)&&(e.preventDefault(),e.stopPropagation()),["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key)){const{columnsCount:t}=this.config,n=this.options.findIndex((e=>e.element===document.activeElement)),s=n%t,i=["ArrowUp","ArrowDown"].includes(e.key)?t:1;if("ArrowLeft"===e.key&&!s||"ArrowRight"===e.key&&s===t-1)return;const o=n+(["ArrowUp","ArrowLeft"].includes(e.key)?-i:i),r=this.options.find(((e,t)=>!e.disabled&&t===o));r&&r.element.focus()}const t=e.key.toLowerCase();if(/^[a-zа-я]$/.test(t)&&!e.altKey&&!e.ctrlKey&&!e.metaKey&&!e.shiftKey){e.preventDefault(),e.stopPropagation();const n=this.options.find((e=>e.label.toLowerCase().startsWith(t)));n&&n.element.focus()}}loadSVG(e,t){const{imageSize:n}=this.config,{imageElement:s,fetchedSVGPromise:i}=t;i||(t.fetchedSVGPromise=fetch(e,{method:"GET",headers:{Accept:"image/avif,image/webp,image/apng,image/svg+xml,image/*,*/*;q=0.8"}}).then((e=>e.text())).then((e=>{const t=(new DOMParser).parseFromString(e,"image/svg+xml").firstElementChild;if(!(t instanceof SVGElement))throw new Error;return t.classList.add("tprev-dropdown__option-image"),t.setAttribute("width",n[0]),t.setAttribute("height",n[1]),t.setAttribute("preserveAspectRatio","xMidYMid meet"),s.replaceWith(t),t})).catch((()=>{delete t.fetchedSVGPromise})))}static getId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let t="tprev_";for(let n=0;n<8;n++){const n=Math.floor(62*Math.random());t+=e.charAt(n)}return t}static getImageSize(e){const t=Array.isArray(e)?e:[e];return t.length||t.push(180,120),1===t.length&&t.push(t[0]),t.splice(2,t.length),t.every((e=>e&&!isNaN(e)))?t:[180,120]}}window.TPreviewbox=t})();